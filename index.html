<!-- Front announcement modal; paste before </body> -->
<div id="announceModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:9999;">
  <div style="max-width:640px;margin:5vh auto;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.15)">
    <div style="padding:12px 16px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;">
      <b>最新公告</b><button id="announceClose" style="font-size:20px;line-height:1;border:0;background:transparent;cursor:pointer">×</button>
    </div>
    <div style="padding:16px;">
      <div id="announceContent"></div>
      <label style="display:flex;gap:8px;align-items:center;margin-top:8px;font-size:14px;color:#555">
        <input type="checkbox" id="announceDontShow"> 今天不要再顯示
      </label>
    </div>
    <div style="padding:12px 16px;border-top:1px solid #eee;text-align:right;">
      <button id="announceOk" style="background:#166534;color:#fff;border:0;border-radius:10px;padding:8px 14px;cursor:pointer">我知道了</button>
    </div>
  </div>
</div>
<script>
(function(){
  var API = 'https://script.google.com/macros/s/AKfycbx4NR0LWj6j27lB_1-LxIDthj2ihaGyEQTQ1hqUNMyX5KC7a1bQtzpZwJYQVvq-6aILUA/exec';
  var key = 'announce_seen_' + new Date().toISOString().slice(0,10);
  if (localStorage.getItem(key)) return;
  fetch(API, { method:'POST', body: JSON.stringify({ action:'getAnnouncement' }) })
    .then(function(r){ return r.json(); })
    .then(function(j){ if(j && j.html) show(j.html); })
    .catch(function(){});
  function show(html){
    var m=document.getElementById('announceModal'); if(!m) return;
    document.getElementById('announceContent').innerHTML=html;
    m.style.display='block';
    var close=function(){
      if(document.getElementById('announceDontShow').checked) localStorage.setItem(key,'1');
      m.style.display='none';
    };
    document.getElementById('announceOk').onclick=close;
    document.getElementById('announceClose').onclick=close;
  }
})();
</script>
